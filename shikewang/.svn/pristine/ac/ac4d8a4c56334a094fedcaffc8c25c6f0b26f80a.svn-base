package com.yshow.shike.fragments;
import java.util.ArrayList;
import java.util.List;
import com.loopj.android.http.AsyncHttpResponseHandler;
import com.nostra13.universalimageloader.core.DisplayImageOptions;
import com.nostra13.universalimageloader.core.ImageLoader;
import com.yshow.shike.R;
import com.yshow.shike.activities.Activity_Teacher_Info;
import com.yshow.shike.entity.Star_Teacher_Parse;
import com.yshow.shike.utils.Dialog;
import com.yshow.shike.utils.Net_Servse;
import com.yshow.shike.utils.SKAsyncApiController;
import com.yshow.shike.utils.SKResolveJsonUtil;

import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.BaseAdapter;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.TextView;
import android.widget.Toast;
public class Fragment_Online_Tea extends Fragment{
	private  ListView online_lv ;
	private DisplayImageOptions options;
	private ImageLoader imageLoader;
	private MyAdapter adapter;
   @Override
public View onCreateView(LayoutInflater inflater, ViewGroup container,
		Bundle savedInstanceState) {
	   View view = View.inflate(getActivity(),R.layout.online_tea_listview, null);
	    online_lv = (ListView) view.findViewById(R.id.online_lv);
	    options = Net_Servse.getInstence().Picture_Shipei(R.drawable.my_tea_phon);
	    imageLoader = ImageLoader.getInstance();
	    Seather_Tea();
	    online_lv.setOnItemClickListener(new OnItemClickListener() {
			@Override
			public void onItemClick(AdapterView<?> arg0, View arg1, int arg2,
					long arg3) {
				Star_Teacher_Parse item = (Star_Teacher_Parse) adapter.getItem(arg2);
				Bundle bundle = new Bundle();
				bundle.putSerializable("headpicture", item);
				Dialog.intent(getActivity(),Activity_Teacher_Info.class, bundle);	
				
			}
		});
	 return view;
  }
   private class MyAdapter extends BaseAdapter{
		private List<Star_Teacher_Parse> online_data;
		public MyAdapter(List<Star_Teacher_Parse> online_data) {
			super();
			this.online_data = online_data;
		}
	@Override
	public int getCount() {
		return online_data.size();
	}
	@Override
	public Object getItem(int arg0) {
		return online_data.get(arg0);
	}
	@Override
	public long getItemId(int arg0) {
		return arg0;
	}

	@Override
	public View getView(int arg0, View convertView, ViewGroup arg2) {
		final Star_Teacher_Parse on_Tea = online_data.get(arg0);
		if (convertView == null) {
			convertView = View.inflate(getActivity(),R.layout.fragment_start_text, null);
		}
		TextView tv_grade = (TextView) convertView.findViewById(R.id.tv_grade);
		tv_grade.setVisibility(View.INVISIBLE);
		ImageView tea_piture = (ImageView) convertView.findViewById(R.id.iv_teather_picture);
		TextView tea_name = (TextView) convertView.findViewById(R.id.tv_nicheng);
		TextView tea_subject = (TextView) convertView.findViewById(R.id.tv_subject);
		TextView jieduan = (TextView) convertView.findViewById(R.id.tv_diqu);
		TextView tea_info = (TextView) convertView.findViewById(R.id.tv_gerenxinxi);
		if(on_Tea !=null){
			tea_name.setText(on_Tea.getNickname());
			tea_subject.setText(on_Tea.getSubiect());
			jieduan.setText(on_Tea.getGrade());
			tea_info.setText(on_Tea.getInfo());
			imageLoader.displayImage(on_Tea.getIcon(), tea_piture,options);
		}
		return convertView;
	}
   }
   private void Seather_Tea(){
	   SKAsyncApiController.OnLine_Tea("1", "0",new AsyncHttpResponseHandler(){
		@Override
		public void onSuccess(String json) {
			super.onSuccess(json);
			boolean success = SKResolveJsonUtil.getInstance().resolveIsSuccess(json, getActivity());
			if(success){
				ArrayList<Star_Teacher_Parse> start_teather = SKResolveJsonUtil.getInstance().start_teather(json);
				if(start_teather.size() != 0){
					adapter = new MyAdapter(start_teather);
					online_lv.setAdapter(adapter);
				}else {
					Toast.makeText(getActivity(),"没有在线老师", 0).show();
				}
				
			}
		 }
	   });
   }
  @Override
	public void onResume() {
		super.onResume();
		if(adapter != null){
			adapter.notifyDataSetChanged();
		}
	  }
}